<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:MauiStrides.Models"
             xmlns:vm="clr-namespace:MauiStrides.ViewModels"
             x:Class="MauiStrides.Views.ProfilePage"
             Title="Profile"
             BackgroundColor="{StaticResource AppBackground}">

    <ScrollView>
        <VerticalStackLayout Padding="15" Spacing="15">

            <!-- Profile Header Section -->
            <Grid ColumnDefinitions="Auto, *" ColumnSpacing="12">

                <!-- Profile Picture -->
                <Border Grid.Column="0" 
                        StrokeShape="RoundRectangle 40" 
                        HeightRequest="80" 
                        WidthRequest="80" 
                        StrokeThickness="0">
                    <Image Source="{Binding CurrentAthleteProfile.Profile}" 
                           Aspect="AspectFill"/>
                </Border>

                <!-- Name and Location Info -->
                <VerticalStackLayout Grid.Column="1" 
                                     Spacing="6" 
                                     VerticalOptions="Center">

                    <!-- Full Name -->
                    <Label FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="{StaticResource AppText}">
                        <Label.Text>
                            <MultiBinding StringFormat="{}{0} {1}">
                                <Binding Path="CurrentAthleteProfile.FirstName" />
                                <Binding Path="CurrentAthleteProfile.LastName" />
                            </MultiBinding>
                        </Label.Text>
                    </Label>

                    <!-- Bio -->
                    <Label Text="{Binding CurrentAthleteProfile.Bio}" 
                           FontSize="13"
                           LineBreakMode="TailTruncation"
                           MaxLines="2"
                           TextColor="{StaticResource AppPrimary}"/>

                    <!-- City, Country -->
                    <HorizontalStackLayout Spacing="4">
                        <Label Text="ðŸ“" FontSize="12"/>
                        <Label FontSize="12" 
                               TextColor="{StaticResource AppSecondary}">
                            <Label.Text>
                                <MultiBinding StringFormat="{}{0}, {1}">
                                    <Binding Path="CurrentAthleteProfile.City" />
                                    <Binding Path="CurrentAthleteProfile.Country" />
                                </MultiBinding>
                            </Label.Text>
                        </Label>
                    </HorizontalStackLayout>

                </VerticalStackLayout>
            </Grid>

            <!-- Overall Stats Grid Card -->
            <Border Style="{StaticResource ActivityCardStyle}" 
                    Padding="15">
                <Grid ColumnDefinitions="*, *, *" 
                      ColumnSpacing="8">

                    <!-- Activity Count -->
                    <VerticalStackLayout Grid.Column="0" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding CurrentMonthActivityCount}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="Activities" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                    </VerticalStackLayout>

                    <!-- Total Hours -->
                    <VerticalStackLayout Grid.Column="1" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding CurrentMonthTotalDuration, StringFormat='{0:F1}'}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="Hours" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                    </VerticalStackLayout>

                    <!-- Total Distance -->
                    <VerticalStackLayout Grid.Column="2" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding CurrentMonthTotalDistance, StringFormat='{0:F0}'}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="km" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                    </VerticalStackLayout>

                </Grid>
            </Border>

            <!-- Activity Types Card -->    
            <Border Style="{StaticResource ActivityCardStyle}" 
                    Padding="15">
                <Grid ColumnDefinitions="*, *, *" 
                      ColumnSpacing="8">

                    <!-- Run Count -->
                    <VerticalStackLayout Grid.Column="0" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding CurrentMonthRunCount}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="ðŸƒâ€" 
                               FontSize="16"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                        <Label Text="Activities" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                     </VerticalStackLayout>

                    <!-- Ride Count -->
                    <VerticalStackLayout Grid.Column="1" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding CurrentMonthRideCount}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="ðŸš´" 
                               FontSize="16"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                        <Label Text="Activities" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                    </VerticalStackLayout>

                    <!-- Virtual Ride Count -->
                    <VerticalStackLayout Grid.Column="2" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding CurrentMonthVirtualRideCount}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="ðŸŽ®" 
                               FontSize="16"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                        <Label Text="Activities" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                    </VerticalStackLayout>

                </Grid>
            </Border>

            
            <Border Style="{StaticResource ActivityCardStyle}" 
                    Padding="15">
                <VerticalStackLayout Spacing="12">

                    <!-- Section Title -->
                    <Label Text="Custom Date Range &amp; Sport Filter" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           TextColor="{StaticResource AppText}"/>

                    <!-- Date Pickers Row -->
                    <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label Text="Start Date" 
                                   FontSize="12" 
                                   TextColor="{StaticResource AppSecondary}"/>
                            <DatePicker Date="{Binding SelectedStartDate}" 
                                        Format="MMM dd, yyyy"
                                        TextColor="{StaticResource AppPrimary}"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="End Date" 
                                   FontSize="12" 
                                   TextColor="{StaticResource AppSecondary}"/>
                            <DatePicker Date="{Binding SelectedEndDate}" 
                                        Format="MMM dd, yyyy"
                                        TextColor="{StaticResource AppPrimary}"/>
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Reset Button -->
                    <Button Text="ðŸ”„ Reset to Current Month"
                            Command="{Binding ResetToCurrentMonthCommand}"
                            BackgroundColor="{StaticResource AppSecondary}"
                            TextColor="White"
                            HeightRequest="40"
                            FontSize="14"/>

                    <!-- Sport Filter Checkboxes -->
                    <Label Text="Select Sports:" 
                           FontSize="12" 
                           TextColor="{StaticResource AppSecondary}"
                           Margin="0,8,0,0"/>

                    <Grid ColumnDefinitions="*, *" 
                          RowDefinitions="Auto, Auto"
                          ColumnSpacing="8"
                          RowSpacing="8">
                        
                        <!-- Row 0, Column 0: Run -->
                        <HorizontalStackLayout Grid.Row="0" Grid.Column="0" Spacing="4">
                            <CheckBox IsChecked="{Binding IsRunSelected}" 
                                      Color="{StaticResource AppPrimary}"/>
                            <Label Text="ðŸƒ Run" 
                                   VerticalOptions="Center"
                                   FontSize="14"
                                   TextColor="{StaticResource AppText}"/>
                        </HorizontalStackLayout>

                        <!-- Row 0, Column 1: Ride -->
                        <HorizontalStackLayout Grid.Row="0" Grid.Column="1" Spacing="4">
                            <CheckBox IsChecked="{Binding IsRideSelected}" 
                                      Color="{StaticResource AppPrimary}"/>
                            <Label Text="ðŸš´ Ride" 
                                   VerticalOptions="Center"
                                   FontSize="14"
                                   TextColor="{StaticResource AppText}"/>
                        </HorizontalStackLayout>

                        <!-- Row 1, Column 0: VirtualRide -->
                        <HorizontalStackLayout Grid.Row="1" Grid.Column="0" Spacing="4">
                            <CheckBox IsChecked="{Binding IsVirtualRideSelected}" 
                                      Color="{StaticResource AppPrimary}"/>
                            <Label Text="ðŸŽ® VR" 
                                   VerticalOptions="Center"
                                   FontSize="14"
                                   TextColor="{StaticResource AppText}"/>
                        </HorizontalStackLayout>

                        <!-- Row 1, Column 1: Nordic Ski -->
                        <HorizontalStackLayout Grid.Row="1" Grid.Column="1" Spacing="4">
                            <CheckBox IsChecked="{Binding IsNordicSkiSelected}" 
                                      Color="{StaticResource AppPrimary}"/>
                            <Label Text="â›·ï¸ XC" 
                                   VerticalOptions="Center"
                                   FontSize="14"
                                   TextColor="{StaticResource AppText}"/>
                        </HorizontalStackLayout>
                    </Grid>


                </VerticalStackLayout>
            </Border>

            <!-- âœ¨ NEW: Filtered Stats Result Card -->
            <Border Style="{StaticResource ActivityCardStyle}" 
                    Padding="15">
                <Grid ColumnDefinitions="*, *, *" 
                      ColumnSpacing="8">

                    <!-- Filtered Activity Count -->
                    <VerticalStackLayout Grid.Column="0" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding FilteredActivityCount}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="Activities" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                    </VerticalStackLayout>

                    <!-- Filtered Total Hours -->
                    <VerticalStackLayout Grid.Column="1" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding FilteredTotalDuration, StringFormat='{0:F1}'}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="Hours" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                    </VerticalStackLayout>

                    <!-- Filtered Total Distance -->
                    <VerticalStackLayout Grid.Column="2" 
                                         Spacing="4" 
                                         HorizontalOptions="Center">
                        <Label Text="{Binding FilteredTotalDistance, StringFormat='{0:F0}'}" 
                               FontSize="28" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppPrimary}"/>
                        <Label Text="km" 
                               FontSize="10"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource AppSecondary}"/>
                    </VerticalStackLayout>

                </Grid>
            </Border>

            <!-- Logout Button -->
            <Button Text="Logout"
                    Command="{Binding LogoutCommand}"
                    BackgroundColor="{StaticResource AppSecondary}"
                    TextColor="White"
                    Margin="0,10,0,0"
                    HorizontalOptions="Fill"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>